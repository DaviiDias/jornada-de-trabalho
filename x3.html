<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Justificativas Jornada Híbrida – Visão Gestor</title>
  <style>
    :root {
      --verde: #15803d;     --verde-claro: #dcfce7;
      --amarelo: #b45309;   --amarelo-claro: #fef3c7;
      --vermelho: #b91c1c;  --vermelho-claro: #fee2e2;
      --azul: #1e40af;      --azul-claro: #dbeafe;
      --bg: #f9fafb; --card: white; --border: #e2e8f0;
      --presencial: #1e40af; --remoto: #059669; --ausente: #991b1b;
    }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: #1e293b;
      margin: 0;
      padding: 16px;
      line-height: 1.5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: var(--card);
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    h1 {
      background: #1e40af;
      color: white;
      margin: 0;
      padding: 20px;
      text-align: center;
      font-size: clamp(1.5rem, 5vw, 1.8rem);
    }
    .resumo {
      padding: 14px 20px;
      background: #f0f9ff;
      border-bottom: 1px solid var(--border);
      font-weight: 500;
    }
    .alert { color: var(--vermelho); font-weight: bold; }

    .overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
      padding: 20px;
    }
    .week-card {
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s;
      background: white;
      position: relative;
    }
    .week-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    }
    .week-header {
      padding: 12px;
      font-weight: 600;
      text-align: center;
      font-size: 1.05rem;
    }
    .week-ok       { background: var(--verde-claro); color: var(--verde); }
    .week-atencao  { background: var(--amarelo-claro); color: var(--amarelo); }
    .week-urgente  { background: var(--vermelho-claro); color: var(--vermelho); }
    .week-justificado { background: var(--azul-claro); color: var(--azul); border-color: var(--azul); }
    .week-count {
      padding: 12px;
      text-align: center;
      font-size: 2rem;
      font-weight: bold;
    }
    .justificado-icon {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      background: var(--verde);
      color: white;
      font-size: 1rem;
      line-height: 24px;
      text-align: center;
      border-radius: 50%;
      display: none;
    }
    .week-justificado .justificado-icon { display: block; }

    #detail-panel {
      padding: 0 20px 40px;
      min-height: 200px;
    }
    .detail-content {
      display: none;
      background: #fafafa;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 24px;
    }
    .detail-content.open { display: block; }
    .days-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 16px;
      margin: 24px 0;
    }
    .day-card {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px;
      text-align: center;
      min-height: 110px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: white;
      position: relative;
    }
    .day-header { font-weight: 600; font-size: 1.1rem; }
    .day-date { font-size: 0.95rem; color: #64748b; margin: 6px 0; }
    .status {
      font-weight: bold;
      padding: 10px 6px;
      border-radius: 8px;
      font-size: 1.05rem;
    }
    .status-presencial { background: #dbeafe; color: var(--presencial); }
    .status-remoto     { background: #d1fae5; color: var(--remoto); }
    .status-ausente    { background: #fee2e2; color: var(--ausente); }

    .just-icon {
      position: absolute;
      bottom: 8px;
      right: 8px;
      width: 26px;
      height: 26px;
      background: #2563eb;
      color: white;
      font-size: 0.85rem;
      font-weight: bold;
      line-height: 26px;
      text-align: center;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.2s;
    }
    .just-icon:hover { background: #1d4ed8; }
    .just-icon.active { background: var(--verde); }

    .justifications-panel {
      margin-top: 32px;
      background: #fffbeb;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid var(--amarelo);
    }
    .just-daily {
      margin-bottom: 16px;
      padding: 12px;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
    }
    .just-daily strong { display: block; margin-bottom: 6px; color: #374151; }
    .just-daily textarea {
      width: 100%;
      min-height: 70px;
      padding: 8px 10px;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      font-size: 0.95rem;
      resize: vertical;
    }
    .just-weekly {
      margin-top: 24px;
    }
    .just-weekly strong {
      display: block;
      margin-bottom: 8px;
      font-size: 1.1rem;
    }
    .just-weekly textarea {
      width: 100%;
      min-height: 180px;
      padding: 14px;
      border: 2px solid var(--amarelo);
      border-radius: 8px;
      resize: vertical;
      font-size: 1rem;
      box-sizing: border-box;
    }
    .submit-btn {
      margin-top: 24px;
      padding: 12px 24px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      cursor: pointer;
      width: 100%;
      max-width: 300px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .submit-btn:hover { background: #1d4ed8; }
    .submit-btn:disabled { background: #9ca3af; cursor: not-allowed; }
    .no-just {
      color: #64748b;
      text-align: center;
      margin: 16px 0;
      font-style: italic;
    }

    @media (max-width: 768px) {
      .overview { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; padding: 12px; }
      .days-grid { grid-template-columns: repeat(3, 1fr); gap: 10px; }
      .week-count { font-size: 1.6rem; }
      .just-icon { width: 28px; height: 28px; font-size: 0.9rem; line-height: 28px; }
      .just-weekly textarea { min-height: 140px; }
    }
    @media (max-width: 480px) {
      .days-grid { grid-template-columns: repeat(2, 1fr); }
      .day-card { min-height: 120px; padding: 12px; }
    }
  </style>
</head>
<body>

<div class="container">
  <h1>Justificativas Jornada Híbrida 3×2</h1>

  <div class="resumo" id="resumo">
    Carregando resumo das últimas 4 semanas...
  </div>

  <div class="overview" id="overview"></div>

  <div id="detail-panel">
    <div class="detail-content" id="detail-content"></div>
  </div>
</div>

<script>
// JSON mockado simulando retorno da API
const dadosApiMock = {
  colaborador: "Luiz Silva",
  semanas: [
    {
      num: 1,
      periodo: "19/01/2026 → 23/01/2026",
      dias: [
        {dia: "Seg", data: "19/01", status: "presencial"},
        {dia: "Ter", data: "20/01", status: "presencial"},
        {dia: "Qua", data: "21/01", status: "remoto"},
        {dia: "Qui", data: "22/01", status: "presencial"},
        {dia: "Sex", data: "23/01", status: "ausente"}
      ]
    },
    {
      num: 2,
      periodo: "12/01/2026 → 16/01/2026",
      dias: [
        {dia: "Seg", data: "12/01", status: "remoto"},
        {dia: "Ter", data: "13/01", status: "presencial"},
        {dia: "Qua", data: "14/01", status: "ausente"},
        {dia: "Qui", data: "15/01", status: "remoto"},
        {dia: "Sex", data: "16/01", status: "presencial"}
      ]
    },
    {
      num: 3,
      periodo: "05/01/2026 → 09/01/2026",
      dias: [
        {dia: "Seg", data: "05/01", status: "ausente"},
        {dia: "Ter", data: "06/01", status: "remoto"},
        {dia: "Qua", data: "07/01", status: "ausente"},
        {dia: "Qui", data: "08/01", status: "remoto"},
        {dia: "Sex", data: "09/01", status: "ausente"}
      ]
    },
    {
      num: 4,
      periodo: "29/12/2025 → 02/01/2026",
      dias: [
        {dia: "Seg", data: "29/12", status: "presencial"},
        {dia: "Ter", data: "30/12", status: "presencial"},
        {dia: "Qua", data: "31/12", status: "presencial"},
        {dia: "Qui", data: "01/01", status: "presencial"},
        {dia: "Sex", data: "02/01", status: "remoto"}
      ]
    }
  ]
};

function getStatusSemana(presCount) {
  if (presCount >= 3) return { class: 'week-ok', label: 'OK', cor: 'var(--verde)' };
  if (presCount === 2) return { class: 'week-atencao', label: 'Atenção', cor: 'var(--amarelo)' };
  return { class: 'week-urgente', label: 'Precisa justificar', cor: 'var(--vermelho)' };
}

function renderOverview(dados) {
  const overview = document.getElementById('overview');
  overview.innerHTML = '';
  dados.semanas.forEach(s => {
    const pres = s.dias.filter(d => d.status === 'presencial').length;
    const st = getStatusSemana(pres);
    const card = document.createElement('div');
    card.className = `week-card ${st.class}`;
    card.dataset.semana = s.num;
    card.innerHTML = `
      <div class="week-header">Semana ${s.num}<br><small>${s.periodo}</small></div>
      <div class="week-count" style="color:${st.cor}">${pres}</div>
      <div style="text-align:center; padding:8px; font-size:0.9rem;">${st.label}</div>
      <div class="justificado-icon">✓</div>
    `;
    card.addEventListener('click', () => showDetail(s, card));
    overview.appendChild(card);
  });
}

function showDetail(s, cardElement) {
  const content = document.getElementById('detail-content');
  const pres = s.dias.filter(d => d.status === 'presencial').length;
  const isRequiredSemanal = pres < 3;
  const st = getStatusSemana(pres);

  content.innerHTML = `
    <h3 style="margin:0 0 20px; text-align:center; color:${st.cor}">
      Semana ${s.num} – ${s.periodo} (${pres} presenciais)
    </h3>

    <div class="days-grid">
      ${s.dias.map(d => {
        let cls = '', txt = '';
        if (d.status === 'presencial') { cls = 'status-presencial'; txt = 'Presencial'; }
        else if (d.status === 'remoto') { cls = 'status-remoto'; txt = 'Remoto'; }
        else { cls = 'status-ausente'; txt = 'Ausente'; }

        const isNaoPresencial = d.status !== 'presencial';

        return `
          <div class="day-card">
            <div class="day-header">${d.dia}</div>
            <div class="day-date">${d.data}</div>
            <div class="status ${cls}">${txt}</div>
            ${isNaoPresencial ? `
              <div class="just-icon" data-dia="${d.dia}" data-data="${d.data}" data-tipo="${txt}">
                J
              </div>
            ` : ''}
          </div>`;
      }).join('')}
    </div>

    <div class="justifications-panel">
      <strong>Justificativas</strong><br>
      <small>Clique no ícone "J" nos dias para adicionar ou remover justificativa diária.</small>

      <div id="daily-fields" style="margin:16px 0;"></div>

      ${isRequiredSemanal ? `
        <div class="just-weekly">
          <strong>Justificativa geral da semana (obrigatória)</strong>
          <textarea id="weekly-textarea" placeholder="Explique o motivo da não conformidade semanal"></textarea>
        </div>
      ` : ''}

      <button id="submit-btn" class="submit-btn">Salvar justificativas desta semana</button>
    </div>
  `;
  content.classList.add('open');
  content.scrollIntoView({ behavior: 'smooth', block: 'start' });

  const submitBtn = document.getElementById('submit-btn');
  const weeklyTextarea = document.getElementById('weekly-textarea');
  const dailyFieldsContainer = document.getElementById('daily-fields');

  // Toggle dos ícones e campos
  document.querySelectorAll('.just-icon').forEach(icon => {
    icon.addEventListener('click', function() {
      const dia = this.dataset.dia;
      const data = this.dataset.data;
      const tipo = this.dataset.tipos;

      const existing = dailyFieldsContainer.querySelector(`[data-dia="${dia}"]`);
      if (existing) {
        existing.remove();
        this.classList.remove('active');
      } else {
        const fieldHtml = `
          <div class="just-daily" data-dia="${dia}">
            <strong>${dia} (${data}) – ${tipo}</strong>
            <textarea class="daily-textarea" placeholder="Justificativa para este dia..."></textarea>
          </div>
        `;
        dailyFieldsContainer.insertAdjacentHTML('beforeend', fieldHtml);
        this.classList.add('active');
      }

      updateJustificadoStatus(cardElement, s);
    });
  });

  // Evento no campo semanal
  if (weeklyTextarea) {
    weeklyTextarea.addEventListener('input', () => updateJustificadoStatus(cardElement, s));
  }

  // Botão de submissão sempre habilitado
  if (submitBtn) {
    submitBtn.disabled = false;

    submitBtn.addEventListener('click', () => {
      submitBtn.disabled = true;
      submitBtn.textContent = 'Salvando...';

      const justificativasDiarias = [];
      dailyFieldsContainer.querySelectorAll('.just-daily').forEach(el => {
        const dia = el.dataset.dia;
        const textarea = el.querySelector('textarea');
        if (textarea.value.trim()) {
          justificativasDiarias.push({
            dia: dia,
            justificativa: textarea.value.trim()
          });
        }
      });

      const justificativaSemanal = weeklyTextarea ? weeklyTextarea.value.trim() : '';

      const payload = {
        colaborador: dadosApiMock.colaborador,
        semana: s.num,
        periodo: s.periodo,
        justificativasDiarias,
        justificativaSemanal
      };

      // Simulação de envio ao servidor
      console.log('Enviando para o servidor:', payload);
      setTimeout(() => {
        alert('Justificativas salvas com sucesso!');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Salvar justificativas desta semana';
        updateJustificadoStatus(cardElement, s);
      }, 1500);
    });
  }

  // Inicializa sem verde automático
  updateJustificadoStatus(cardElement, s);
}

function updateJustificadoStatus(cardElement, s) {
  const dailyFields = document.getElementById('daily-fields');
  const weeklyField = document.querySelector('.just-weekly textarea');

  const pres = s.dias.filter(d => d.status === 'presencial').length;
  let justifiedDays = 0;

  // Conta apenas dias com texto preenchido
  if (dailyFields) {
    dailyFields.querySelectorAll('.just-daily textarea').forEach(textarea => {
      if (textarea.value.trim() !== '') justifiedDays++;
    });
  }

  const hasWeeklyContent = weeklyField && weeklyField.value.trim() !== '';

  // Regra: verde se
  // 1. Campo semanal tem texto (critério suficiente sozinho)
  // OU
  // 2. Dias presenciais + dias com justificativa preenchida ≥ 3
  const isJustificado = hasWeeklyContent || (pres + justifiedDays >= 3);

  if (isJustificado) {
    cardElement.classList.add('week-justificado');
  } else {
    cardElement.classList.remove('week-justificado');
  }
}

function atualizarResumo() {
  const dados = dadosApiMock;
  const nc = dados.semanas.filter(s => s.dias.filter(d => d.status === 'presencial').length < 3).length;
  const total = dados.semanas.reduce((sum, s) => sum + s.dias.filter(d => d.status === 'presencial').length, 0);

  document.getElementById('resumo').innerHTML = `
    <strong>Resumo (${dados.colaborador || 'Colaborador não identificado'}):</strong><br>
    Semanas que exigem justificativa semanal: <span class="${nc > 0 ? 'alert' : ''}">${nc}</span> de 4<br>
    Total de dias presenciais (últimas 4 semanas): <strong>${total}</strong>
  `;
}

// Inicializa com o JSON mockado
renderOverview(dadosApiMock);
atualizarResumo();
</script>

</body>
</html>

